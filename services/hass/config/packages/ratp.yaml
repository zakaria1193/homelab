#############################
# 1 â€” Template helpers
#############################
template:
  - sensor:
      # Minutes until the very next bus 171
      - name: "minutes_to_next_bus_171"
        unique_id: minutes_to_next_bus_171
        unit_of_measurement: "min"
        state: >
          {% set ts = states('sensor.bus_171_next_0') %}
          {% if ts not in ['unknown','unavailable',''] %}
            {{ ((as_timestamp(ts) - as_timestamp(now())) / 60) | round(0, default=0) }}
          {% else %}
            unknown
          {% endif %}

      # Minutes until the very next train on line L
      - name: "minutes_to_next_train_l"
        unique_id: minutes_to_next_train_l
        unit_of_measurement: "min"
        state: >
          {% set ts = states('sensor.l_line_next_0') %}
          {% if ts not in ['unknown','unavailable',''] %}
            {{ ((as_timestamp(ts) - as_timestamp(now())) / 60) | round(0, default=0) }}
          {% else %}
            unknown
          {% endif %}
